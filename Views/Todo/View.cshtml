@model TodoApp.Models.TodoContainer

@{
    ViewData["Title"] = "Todo Items - " + Model.Title;
}

<div class="container my-5">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="fw-bold">üìã @Model.Title</h2>
        <a asp-controller="Home" asp-action="Index" class="btn btn-outline-secondary">‚¨Ö Tr·ªü l·∫°i danh s√°ch</a>
    </div>

    <!-- Danh s√°ch c√°c Todo Item -->
    @if (Model.TodoItems.Any())
    {
        <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4 mb-4">
            @foreach (var item in Model.TodoItems)
            {
                <div class="col">
                    <div class="card h-100 shadow-sm border-gray-300">
                        <div class="card-body">
                            <h5 class="card-title d-flex justify-content-between align-items-center">
                                @item.Title
                                @if (item.IsDone)
                                {
                                    <span class="badge bg-success">‚úî</span>
                                }
                                else
                                {
                                    <span class="badge bg-warning text-dark">‚è≥</span>
                                }
                            </h5>
                            <p class="card-subtitle text-muted">T·∫°o l√∫c: @item.CreatedAt.ToString("yyyy-MM-dd HH:mm")</p>

                            <div class="d-flex gap-2 mt-3">
                                <button class="btn btn-sm btn-outline-primary"
                                        data-bs-toggle="modal"
                                        data-bs-target="#todoModal"
                                        data-id="@item.Id"
                                        data-title="@item.Title"
                                        data-isdone="@item.IsDone.ToString().ToLower()">
                                    ‚úèÔ∏è S·ª≠a
                                </button>
                                <form method="post" asp-action="Delete" asp-route-id="@item.Id" class="d-inline">
                                    <button type="submit" class="btn btn-sm btn-outline-danger">üóë X√≥a</button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            }
        </div>
    }
    else
    {
        <div class="alert alert-info text-center">Ch∆∞a c√≥ c√¥ng vi·ªác n√†o trong Container n√†y. B·∫Øt ƒë·∫ßu th√™m m·ªôt c√°i nh√©!</div>
    }

    <div class="text-center mt-4">
        <button class="btn btn-primary px-4" data-bs-toggle="modal" data-bs-target="#todoModal" data-id="0">
            ‚ûï Th√™m Todo
        </button>
    </div>
</div>


<!-- Modal ƒë·ªÉ th√™m v√† s·ª≠a Todo Item -->
<div class="modal fade" id="todoModal" tabindex="-1" aria-labelledby="todoModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="todoModalLabel">Th√™m Todo Item</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="todoForm" method="post" asp-action="CreateOrUpdate" asp-controller="Todo" asp-route-containerId="@Model.Id">
                    <input type="hidden" id="todoId" name="Id" />
                    <div class="mb-3">
                        <label for="todoTitle" class="form-label">Ti√™u ƒë·ªÅ</label>
                        <input type="text" class="form-control" id="todoTitle" name="Title" required>
                    </div>
                    <div class="mb-3">
                        <label for="todoIsDone" class="form-label">Tr·∫°ng th√°i</label>
                        <select class="form-select" id="todoIsDone" name="IsDone">
                            <option value="false">ƒêang l√†m</option>
                            <option value="true">Ho√†n th√†nh</option>
                        </select>
                    </div>

                    <button type="submit" class="btn btn-primary">L∆∞u Todo</button>
                </form>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        // X·ª≠ l√Ω hi·ªÉn th·ªã modal s·ª≠a ho·∫∑c th√™m Todo
        $('#todoModal').on('show.bs.modal', function (event) {
            var button = $(event.relatedTarget); // N√∫t ƒë√£ k√≠ch ho·∫°t modal
            var todoId = button.data('id'); // L·∫•y id t·ª´ thu·ªôc t√≠nh data-id
            var todoTitle = button.data('title'); // L·∫•y title t·ª´ thu·ªôc t√≠nh data-title
            var todoIsDone = button.data('isdone'); // L·∫•y tr·∫°ng th√°i t·ª´ thu·ªôc t√≠nh data-isdone
            var modal = $(this);

            modal.find('.modal-title').text(todoId == 0 ? 'Th√™m Todo Item' : 'S·ª≠a Todo Item');
            modal.find('#todoId').val(todoId);
            modal.find('#todoTitle').val(todoTitle);

            console.log(todoIsDone); // Ki·ªÉm tra gi√° tr·ªã c·ªßa todoIsDone trong console

            // ƒê·∫£m b·∫£o tr·∫°ng th√°i IsDone ƒë∆∞·ª£c ch·ªçn ƒë√∫ng trong select
            modal.find('#todoIsDone').val(todoIsDone == true ? 'true' : 'false'); // Ki·ªÉm tra n·∫øu "true" (chu·ªói) th√¨ ch·ªçn ƒë√∫ng option
        });
    </script>
}
